{% extends 'base.html' %}
{% block title %}{{results.query}} | Results{% endblock title %}
{% block extra_head %}
<script defer>
    // JavaScript code
    function highlightPhrase(e, phrase) {
        // const textElement = document.getElementById("text");
        // const text = textElement.innerHTML;
        console.log(e);
        const text = e.innerHTML;
        const highlightedText = text.replace(new RegExp(phrase, "gi"), "<span class='highlight'>$&</span>");
        e.innerHTML = highlightedText;
    }
    document.addEventListener("DOMContentLoaded", function() {
        const elements = document.querySelectorAll("[data-hightlight]");
        elements.forEach(function(e) {
            highlightPhrase(e, e.dataset.hightlight);
        });
    });
</script>
<style>
    .highlight {
        background-color: rgba(250, 204, 21, 0.8);
        color: #0f172a;
        padding: 0 0.15rem;
        border-radius: 0.25rem;
    }
</style>
{% endblock extra_head %}
{% block main %}
<section class="space-y-6">
    <div class="rounded-3xl border border-slate-200 bg-white p-6 shadow-soft">
        <p class="text-xs uppercase tracking-[0.3em] text-slate-500">Search</p>
        <h1 class="mt-2 text-3xl font-semibold text-slate-900">Results for "{{ results.query }}"</h1>
        <p class="mt-2 text-sm text-slate-600">Total frequency: {{ results.total_frequency }}</p>
    </div>

    {% if results %}
    <div class="grid gap-6">
        {% for result in results.results %}
        <article class="rounded-3xl border border-slate-200 bg-white p-6 shadow-soft">
            <div class="flex flex-wrap items-center justify-between gap-3">
                <h2 class="text-xl font-semibold text-slate-900">
                    <a title="Go to full article page" href="{% url 'article_detail' article_id=result.article.pk %}" target="_blank" rel="noopener noreferrer" class="transition hover:text-brand-400">{{ result.article.title }}</a>
                </h2>
                {% if result.article.link %}
                <a class="rounded-full border border-slate-300 px-3 py-1 text-sm text-slate-700 transition hover:border-brand-500 hover:text-brand-700" href="{{ result.article.link }}" target="_blank" rel="noopener noreferrer">ðŸ”— Source</a>
                {% endif %}
            </div>
            {% if result.article.author %}
            <p class="mt-2 text-sm text-slate-600">by {{ result.article.author }} in {{ result.article.published_year }}</p>
            {% endif %}
            <p class="mt-1 text-sm text-slate-600">Published in {{ result.article.newspaper.title }}</p>
            <p class="mt-3 text-sm text-slate-700">Frequency: <span class="font-semibold text-slate-900">{{ result.frequency }}</span></p>
            <ol class="mt-4 space-y-3 text-sm text-slate-700">
                {% for location in result.locations %}
                <li class="rounded-xl border border-slate-200 bg-slate-50 px-4 py-3">
                    <div class="mb-2 text-xs uppercase tracking-[0.2em] text-slate-500">{{ location.type }}</div>
                    <span data-hightlight="{{results.query}}" data-gender-annotations>{{ location.context }}</span>
                </li>
                {% endfor %}
            </ol>
        </article>
        {% endfor %}
    </div>
    {% else %}
    <div class="rounded-3xl border border-dashed border-slate-300 px-6 py-12 text-center text-slate-500">No results found.</div>
    {% endif %}
</section>

{% endblock main %}
