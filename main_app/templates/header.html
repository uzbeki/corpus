{% comment %} Navigation with search bar {% endcomment %}
<header class="border-b border-slate-200/80 bg-white/90">
    <div class="mx-auto flex w-full max-w-6xl flex-col gap-3 px-4 py-3 sm:px-6 lg:px-8">
        <div class="flex flex-wrap items-center justify-between gap-3">
            <a class="text-lg font-semibold tracking-tight text-slate-900" href="{% url 'index' %}">zakhri-corpus</a>
            <div class="flex items-center gap-3 text-sm">
                {% if user.is_authenticated %}
                <a class="rounded-full border border-slate-300 px-3 py-1 text-slate-700 transition hover:border-brand-500 hover:text-brand-700" href="{% url 'admin:index' %}">@{{user.username}}</a>
                <a class="rounded-full bg-slate-100 px-3 py-1 text-slate-700 transition hover:bg-slate-200" href="{% url 'account_logout' %}">Logout</a>
                {% else %}
                <a class="rounded-full border border-slate-300 px-3 py-1 text-slate-700 transition hover:border-brand-500 hover:text-brand-700" href="{% url 'account_login' %}">Login</a>
                <a class="rounded-full bg-brand-600 px-3 py-1 text-white shadow-soft transition hover:bg-brand-500" href="{% url 'account_signup' %}">Register</a>
                {% endif %}
            </div>
        </div>

        <form class="w-full rounded-2xl border border-slate-200 bg-white p-3 shadow-soft" action="{% url 'search' %}" method="get">
            <div class="flex flex-col gap-3 sm:flex-row sm:items-center sm:flex-nowrap">
                <div class="relative flex-1">
                    <span class="pointer-events-none absolute left-3 top-1/2 -translate-y-1/2 text-slate-400">üîç</span>
                    <input class="h-10 w-full rounded-xl border border-slate-300 bg-white pl-9 pr-3 text-sm text-slate-900 outline-none transition focus:border-brand-500 focus:ring-2 focus:ring-brand-500/30" type="search" placeholder="Search the corpus" aria-label="Search" name="q" value="{{request.GET.q}}" title='Only letters and numbers are allowed.' required>
                </div>
                <div class="flex flex-wrap gap-2 sm:flex-nowrap">
                    <button type="button" id="filterToggle" class="inline-flex h-10 items-center gap-2 rounded-xl border border-slate-300 bg-slate-50 px-3 text-sm text-slate-600 transition hover:border-brand-500/60">
                        <span class="text-xs uppercase tracking-[0.2em] text-slate-500">Filters</span>
                        <span id="filterChevron" class="text-slate-400 transition">‚ñæ</span>
                    </button>
                    <button class="h-10 rounded-xl bg-brand-600 px-4 text-sm font-semibold text-white shadow-soft transition hover:bg-brand-500" type="submit">Search</button>
                </div>
            </div>
            <div id="filterPanel" class="filter-panel">
                <div class="mt-3 rounded-xl border border-slate-200 bg-slate-50 px-3 py-3 text-sm text-slate-700">
                    <div class="grid gap-3 md:grid-cols-3">
                    <label class="flex flex-col gap-2 text-xs uppercase tracking-[0.2em] text-slate-500">
                        Language
                        <select name="language" id="language" class="h-10 rounded-xl border border-slate-300 bg-white px-3 text-sm text-slate-900 outline-none transition focus:border-brand-500 focus:ring-2 focus:ring-brand-500/30">
                            <option value="1" {% if request.GET.language == '1' %} selected {% endif %}>English</option>
                            <option value="2" {% if request.GET.language == '2' %} selected {% endif %}>Uzbek</option>
                        </select>
                    </label>
                    <label class="flex flex-col gap-2 text-xs uppercase tracking-[0.2em] text-slate-500">
                        Match
                        <select name="match_type" id="match_type" class="h-10 rounded-xl border border-slate-300 bg-white px-3 text-sm text-slate-900 outline-none transition focus:border-brand-500 focus:ring-2 focus:ring-brand-500/30">
                            <option value="0" {% if request.GET.match_type == '0' %} selected {% endif %}>Both</option>
                            <option value="1" {% if request.GET.match_type == '1' %} selected {% endif %}>Exact</option>
                            <option value="2" {% if request.GET.match_type == '2' %} selected {% endif %}>Partial</option>
                        </select>
                    </label>
                    <label class="flex flex-col gap-2 text-xs uppercase tracking-[0.2em] text-slate-500">
                        Year
                        <input type="text" name="year" id="year" placeholder="YYYY" pattern='[0-9]{4}' title='Only numbers are allowed.' value='{{request.GET.year}}' maxlength="4" class="h-10 rounded-xl border border-slate-300 bg-white px-3 text-sm text-slate-900 outline-none transition focus:border-brand-500 focus:ring-2 focus:ring-brand-500/30">
                    </label>
                    </div>
                </div>
            </div>
        </form>
    </div>
</header>

<script>
    const filterToggle = document.getElementById('filterToggle');
    const filterPanel = document.getElementById('filterPanel');
    const filterChevron = document.getElementById('filterChevron');

    if (filterToggle && filterPanel) {
        filterToggle.addEventListener('click', () => {
            const isOpen = filterPanel.classList.toggle('is-open');
            if (filterChevron) {
                filterChevron.style.transform = isOpen ? 'rotate(180deg)' : 'rotate(0deg)';
            }
        });
    }
</script>